{
  "hash": "5f1d8d5ad31e9a13b8f0624ded60930f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidy data\"\nformat:\n  html: \n    toc: false\n    section-divs: true\n    include-after-body: \n      - text: |\n          <script src=\"/js/progressive-reveal.js\"></script>\n          <script src=\"/js/bootstrapify.js\"></script>\n\nengine: knitr\nfilters:\n  - webr\nwebr:\n  packages:\n    - tidyr\n  cell-options:\n    editor-font-scale: 0.85\n    fig-width: 6\n    fig-height: 3.7\n    out-width: \"70%\"\n---\n\n\n\n\n\n\n### Variables, values, and observations {.no-hide}\n\nIn the [exploratory data analysis](/03-viz/01-02-eda/01-eda.html) primer, we proposed three definitions that are useful for data science:\n\n* A __variable__ is a quantity, quality, or property that you can measure. \n\n* A __value__ is the state of a variable when you measure it. The value of a variable may change from measurement to measurement.\n  \n* An __observation__ is a set of measurements that are made under similar conditions (you usually make all of the measurements in an observation at the same time and on the same object). An observation will contain several values, each associated with a different variable. I'll sometimes refer to an observation as a case or data point.\n\nThese definitions are tied to the concept of tidy data. To see how, let's apply the definitions to some real data.\n\n### Quiz 1: What are the variables?\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n::: {.callout-note appearance=\"simple\" icon=false .question}\n\n**What are the variables in the dataset above? Check all that apply.**\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<form name=\"form_41964\" onsubmit=\"return validate_form_41964()\" method=\"post\">\n<input type=\"checkbox\" id=\"answer_41964_1\" value=\"country\"/>\n<label>country</label>\n<br/>\n<input type=\"checkbox\" id=\"answer_41964_2\" value=\"year\"/>\n<label>year</label>\n<br/>\n<input type=\"checkbox\" id=\"answer_41964_3\" value=\"cases\"/>\n<label>cases</label>\n<br/>\n<input type=\"checkbox\" id=\"answer_41964_4\" value=\"population\"/>\n<label>population</label>\n<br/>\n<input type=\"checkbox\" id=\"answer_41964_5\" value=\"count\"/>\n<label>count</label>\n<br/>\n<input type=\"checkbox\" id=\"answer_41964_6\" value=\"type\"/>\n<label>type</label>\n<br/>\n<input type=\"submit\" value=\"Submit answer\"/>\n<div id=\"result_41964\"></div>\n</form>\n<script>function validate_form_41964() {var text; var x1 = document.getElementById('answer_41964_1'); var x2 = document.getElementById('answer_41964_2'); var x3 = document.getElementById('answer_41964_3'); var x4 = document.getElementById('answer_41964_4'); var x5 = document.getElementById('answer_41964_5'); var x6 = document.getElementById('answer_41964_6'); if (x1.checked == true&x2.checked == true&x3.checked == true&x4.checked == true&x5.checked == false&x6.checked == false){text = 'Correct! The dataset contains four variables measured on six observations: country, year, cases, and population.';} else {text = 'I have a different answer';} document.getElementById('result_41964').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){\n         element = document.getElementById('checkdown_final_score');\n         if(element === null){return false;} else {var element, text, res1;res1 = document.getElementById('result_41964').innerText == 'Correct! The dataset contains four variables measured on six observations: country, year, cases, and population.';text = res1;element.innerHTML = text;\n         return false;\n         }}</script>\n```\n\n:::\n:::\n\n\n\n:::\n\n\n### Quiz 2: What are the variables?\n\nNow consider this dataset. Does it contain the same variables?\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n   country      year type            count\n   <chr>       <dbl> <chr>           <dbl>\n 1 Afghanistan  1999 cases             745\n 2 Afghanistan  1999 population   19987071\n 3 Afghanistan  2000 cases            2666\n 4 Afghanistan  2000 population   20595360\n 5 Brazil       1999 cases           37737\n 6 Brazil       1999 population  172006362\n 7 Brazil       2000 cases           80488\n 8 Brazil       2000 population  174504898\n 9 China        1999 cases          212258\n10 China        1999 population 1272915272\n11 China        2000 cases          213766\n12 China        2000 population 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n::: {.callout-note appearance=\"simple\" icon=false .question}\n\n**Does the data above contain information on *country*, *year*, *cases*, and *population*?**\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<form name=\"form_84066\" onsubmit=\"return validate_form_84066()\" method=\"post\">\n<input type=\"radio\" name=\"answer_84066\" id=\"answer_84066_1\" value=\"Yes\"/>\n<label>Yes</label>\n<br/>\n<input type=\"radio\" name=\"answer_84066\" id=\"answer_84066_2\" value=\"No\"/>\n<label>No</label>\n<br/>\n<input type=\"submit\" value=\"Submit answer\"/>\n<div id=\"result_84066\"></div>\n</form>\n<script>function validate_form_84066() {var x, text; var x = document.forms['form_84066']['answer_84066'].value;if (x == 'Yes'){text = 'Correct! If you look closely, you will see that this is the same data set as before, but organized in a new way.';} else {text = 'Don’t be mislead by the two new column names: a variable and a column name are not necessarily the same thing.';} document.getElementById('result_84066').innerHTML = text; evaluate_final_score(); return false;}function evaluate_final_score(){\n         element = document.getElementById('checkdown_final_score');\n         if(element === null){return false;} else {var element, text, res1, res2;res1 = document.getElementById('result_41964').innerText == 'Correct! The dataset contains four variables measured on six observations: country, year, cases, and population.'; res2 = document.getElementById('result_84066').innerText == 'Correct! If you look closely, you will see that this is the same data set as before, but organized in a new way.';text = res1 + res2;element.innerHTML = text;\n         return false;\n         }}</script>\n```\n\n:::\n:::\n\n\n\n:::\n\n\n### The shapes of data\n\nThese data sets reveal something important: _you can reorganize the same set of variables, values, and observations in many different ways._\n\nIt's not hard to do. If you run the code chunks below, you can see the same data displayed in three more ways. \n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\ntable3\n\n\n```\n\n:::\n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\ntable4a; table4b\n\n\n```\n\n:::\n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\ntable5\n\n\n```\n\n:::\n\n\n### Tidy data\n\nData can come in a variety of formats, but one format is easier to use in R than the others. This format is known as **tidy data**. A data set is tidy if:\n\n1. Each _variable_ is in its own _column_\n2. Each _observation_ is in its own _row_\n3. Each _value_ is in its own _cell_ (this follows from #1 and #2)\n\n![](img/tidy.png){width=80%}\n\nAmong our tables above, only `table1` is tidy. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n### Extracting variables\n\nTo see why tidy data is easier to use, consider a basic task. Each code chunk below extracts the values of the `cases` variable as a vector and computes the mean of the variable. One uses a tidy table, `table1`:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmean(table1$cases)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 91276.67\n```\n\n\n:::\n:::\n\n\n\n\nThe other uses an untidy table, `table2`:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n   country      year type            count\n   <chr>       <dbl> <chr>           <dbl>\n 1 Afghanistan  1999 cases             745\n 2 Afghanistan  1999 population   19987071\n 3 Afghanistan  2000 cases            2666\n 4 Afghanistan  2000 population   20595360\n 5 Brazil       1999 cases           37737\n 6 Brazil       1999 population  172006362\n 7 Brazil       2000 cases           80488\n 8 Brazil       2000 population  174504898\n 9 China        1999 cases          212258\n10 China        1999 population 1272915272\n11 China        2000 cases          213766\n12 China        2000 population 1280428583\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmean(table2$count[c(1, 3, 5, 7, 9, 11)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 91276.67\n```\n\n\n:::\n:::\n\n\n\n\nWhich line of code is easier to write? Which line could you write if you've only looked at the first row of the data?\n\n### Reusing code\n\nNot only is the code for `table1` easier to write, it is easier to reuse. To see what I mean, modify the code chunks below to compute the mean of the `population` variable for each table.\n\nFirst with `table1`:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\nmean(table1$cases)\n\n\n```\n\n## {{< fa circle-check >}}&ensp;Solution\n\n```r\nmean(table1$population)\n```\n\n:::\n\n\nThen with `table2`:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n   country      year type            count\n   <chr>       <dbl> <chr>           <dbl>\n 1 Afghanistan  1999 cases             745\n 2 Afghanistan  1999 population   19987071\n 3 Afghanistan  2000 cases            2666\n 4 Afghanistan  2000 population   20595360\n 5 Brazil       1999 cases           37737\n 6 Brazil       1999 population  172006362\n 7 Brazil       2000 cases           80488\n 8 Brazil       2000 population  174504898\n 9 China        1999 cases          212258\n10 China        1999 population 1272915272\n11 China        2000 cases          213766\n12 China        2000 population 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\nmean(table2$count[c(1, 3, 5, 7, 9, 11)])\n\n\n```\n\n## {{< fa circle-check >}}&ensp;Solution\n\n```r\nmean(table2$count[c(2, 4, 6, 8, 10, 12)])\n```\n\n:::\n\nAgain `table1` is easier to work with; you only need to change the name of the variable that you wish to extract. Code like this is easier to generalize to new datasets (if they are tidy) and easier to automate with a function.\n\nLet's look at one more advantage.\n\n### Calculations\n\nSuppose you would like to compute the ratios of `cases` to `population` for each country and each year. To do this, you need to ensure that the correct value of `cases` is paired with the correct value of `population` when you do the calculation.\n\nAgain, this is hard to do with untidy `table2`:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n   country      year type            count\n   <chr>       <dbl> <chr>           <dbl>\n 1 Afghanistan  1999 cases             745\n 2 Afghanistan  1999 population   19987071\n 3 Afghanistan  2000 cases            2666\n 4 Afghanistan  2000 population   20595360\n 5 Brazil       1999 cases           37737\n 6 Brazil       1999 population  172006362\n 7 Brazil       2000 cases           80488\n 8 Brazil       2000 population  174504898\n 9 China        1999 cases          212258\n10 China        1999 population 1272915272\n11 China        2000 cases          213766\n12 China        2000 population 1280428583\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable2$count[c(1, 3, 5, 7, 9, 11)] / table2$count[c(2, 4, 6, 8, 10, 12)]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.0000372741 0.0001294466 0.0002193930 0.0004612363 0.0001667495\n[6] 0.0001669488\n```\n\n\n:::\n:::\n\n\n\n\nBut it is easy to do with tidy `table1`. Give it a try below:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  country      year  cases population\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Afghanistan  1999    745   19987071\n2 Afghanistan  2000   2666   20595360\n3 Brazil       1999  37737  172006362\n4 Brazil       2000  80488  174504898\n5 China        1999 212258 1272915272\n6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n::: {.panel-tabset}\n## {{< fa code >}}&ensp;Interactive editor\n\n```{webr-r}\n\n\n\n```\n\n## {{< fa circle-check >}}&ensp;Solution\n\n```r\ntable1$cases / table1$population\n```\n\n:::\n\nThese small differences may seem petty, but they add up over the course of a data analysis, stealing time and inviting mistakes.\n\n### Tidy data and R\n\nThe tidy data format works so well for R because it aligns the structure of your data with the mechanics of R: \n\n* R stores each data frame as a list of column vectors, which makes it easy to extract a column from a data frame as a vector. Tidy data places each variable in its own column vector, which makes it easy to extract all of the values of a variable to compute a summary statistic, or to use the variable in a computation.\n\n* R computes many functions and operations in a vectorized fashion, matching the first values of each vector of input to compute the first result, matching the second values of each input to compute the second result, and so on. Tidy data ensures that R will always match values with other values from the same operation whenever vector inputs are drawn from the same table. \n\n![](img/vectorized.png){width=80%}\n\nAs a result, most functions in R---and every function in the tidyverse---will expect your data to be organized into a tidy format. (You may have noticed above that we could use {dplyr} functions to work on `table1`, but not on `table2`).\n\n### Recap\n\n> \"Data comes in many formats, but R prefers just one: tidy data.\" \n> \n> --- Garrett Grolemund\n\nA data set is tidy if:\n\n1. Each _variable_ is in its own _column_\n2. Each _observation_ is in its own _row_\n3. Each _value_ is in its own _cell_ (this follows from #1 and #2)\n\n![](img/tidy.png){width=80%}\n\nNow that you know what tidy data is, what can you do about untidy data?\n\n\n##\n\n\n\n\n::: {.cell layout-align=\"center\"}\n<section id=\"buttons\">\n<button id=\"continueButton\" class=\"btn btn-primary float-start me-2\">Continue</button>\n<a id=\"nextTopicButton\" class=\"btn btn-danger disabled\" href=\"02-wide-to-long.html\" role=\"button\">Next topic</a>\n<button id=\"resetButton\" class=\"btn btn-outline-warning btn-sm float-end\">Start over</button>\n</section>\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}